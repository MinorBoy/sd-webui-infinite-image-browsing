import{be as A,v as b,c0 as J,c1 as w,ak as C,c as _,a6 as j,ah as V,bO as q,b4 as B,c2 as G}from"./index-e82e9f1c.js";import{u as Q,b as H,f as T,c as U,d as W,e as X,h as Y}from"./FileItem-3c183d4e.js";let Z=0;const K=()=>++Z,ee=(t,e,{dataUpdateStrategy:n="replace"}={})=>{const r=A([""]),a=b(!1),s=b(),o=b(!1);let f=b(-1);const d=new Set,O=l=>{var i;n==="replace"?s.value=l:n==="merge"&&(C((Array.isArray(s.value)||typeof s.value>"u")&&Array.isArray(l),"数据更新策略为合并时仅可用于值为数组的情况"),s.value=[...(i=s==null?void 0:s.value)!==null&&i!==void 0?i:[],...l])},v=l=>w(void 0,void 0,void 0,function*(){if(o.value||a.value&&typeof l>"u")return!1;o.value=!0;const i=K();f.value=i;try{let c;if(typeof l=="number"){if(c=r[l],typeof c!="string")return!1}else c=r[r.length-1];const m=yield t(c);if(d.has(i))return d.delete(i),!1;O(e(m));const u=m.cursor;if((l===r.length-1||typeof l!="number")&&(a.value=!u.has_next,u.has_next)){const y=u.next_cursor||u.next;C(typeof y=="string"),r.push(y)}}finally{f.value===i&&(o.value=!1)}return!0}),h=()=>{d.add(f.value),o.value=!1},I=(l=!1)=>w(void 0,void 0,void 0,function*(){const{refetch:i,force:c}=typeof l=="object"?l:{refetch:l};c&&h(),C(!o.value),r.splice(0,r.length,""),o.value=!1,s.value=void 0,a.value=!1,i&&(yield v())}),p=()=>({next:()=>w(void 0,void 0,void 0,function*(){if(o.value)throw new Error("不允许同时迭代");return{done:!(yield v()),value:s.value}})});return J({abort:h,load:a,next:v,res:s,loading:o,cursorStack:r,reset:I,[Symbol.asyncIterator]:p,iter:{[Symbol.asyncIterator]:p}})};var te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M603.3 327.5l-246 178a7.95 7.95 0 000 12.9l246 178c5.3 3.8 12.7 0 12.7-6.5V643c0-10.2-4.9-19.9-13.2-25.9L457.4 512l145.4-105.2c8.3-6 13.2-15.6 13.2-25.9V334c0-6.5-7.4-10.3-12.7-6.5z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"left-circle",theme:"outlined"};const ne=te;function L(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},r=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable}))),r.forEach(function(a){re(t,a,n[a])})}return t}function re(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var x=function(e,n){var r=L({},e,n.attrs);return _(j,L({},r,{icon:ne}),null)};x.displayName="LeftCircleOutlined";x.inheritAttrs=!1;const ue=x;var ae={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M666.7 505.5l-246-178A8 8 0 00408 334v46.9c0 10.2 4.9 19.9 13.2 25.9L566.6 512 421.2 617.2c-8.3 6-13.2 15.6-13.2 25.9V690c0 6.5 7.4 10.3 12.7 6.5l246-178c4.4-3.2 4.4-9.8 0-13z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"right-circle",theme:"outlined"};const le=ae;function R(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},r=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable}))),r.forEach(function(a){se(t,a,n[a])})}return t}function se(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var P=function(e,n){var r=R({},e,n.attrs);return _(j,R({},r,{icon:le}),null)};P.displayName="RightCircleOutlined";P.inheritAttrs=!1;const fe=P,de=t=>A(ee(t,e=>e.files,{dataUpdateStrategy:"merge"})),ve=t=>{const e=A(new Set),n=V(()=>(t.res??[]).filter(g=>!e.has(g.fullpath))),r=q(),{stackViewEl:a,multiSelectedIdxs:s,stack:o,scroller:f}=Q({images:n}).toRefs(),{itemSize:d,gridItems:O,cellWidth:v,onScroll:h}=H({fetchNext:()=>t.next()}),{showMenuIdx:I}=T(),{onFileDragStart:p,onFileDragEnd:l}=U(),{showGenInfo:i,imageGenInfo:c,q:m,onContextMenuClick:u,onFileItemClick:y}=W({openNext:B}),{previewIdx:M,previewing:z,onPreviewVisibleChange:E,previewImgMove:k,canPreview:N}=X(),$=async(g,S,D)=>{o.value=[{curr:"",files:n.value}],await u(g,S,D)};Y("removeFiles",async({paths:g})=>{g.forEach(S=>e.add(S))});const F=()=>{G(n.value)};return{images:n,scroller:f,queue:r,iter:t,onContextMenuClickU:$,stackViewEl:a,previewIdx:M,previewing:z,onPreviewVisibleChange:E,previewImgMove:k,canPreview:N,itemSize:d,gridItems:O,showGenInfo:i,imageGenInfo:c,q:m,onContextMenuClick:u,onFileItemClick:y,showMenuIdx:I,multiSelectedIdxs:s,onFileDragStart:p,onFileDragEnd:l,cellWidth:v,onScroll:h,saveLoadedFileAsJson:F,saveAllFileAsJson:async()=>{for(;!t.load;)await t.next();F()}}};export{ue as L,fe as R,de as c,ve as u};
