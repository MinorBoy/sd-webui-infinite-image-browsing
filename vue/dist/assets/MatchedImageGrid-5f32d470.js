import{d as X,s as Y,a5 as ee,o as r,k as v,c as l,B as n,E as e,G as F,l as c,H as se,t as a,m as u,A as V,R as te,p as f,T as D,V as le,W as ie,Z as B,bD as ne,q as oe}from"./index-e82e9f1c.js";import{f as ae,S as de}from"./fullScreenContextMenu-7792ff59.js";import{g as re,F as ce}from"./FileItem-3c183d4e.js";import{c as me,u as ue,L as pe,R as ge}from"./hook-a9271142.js";import{o as ve}from"./functionalCallableComp-4ee97acb.js";import"./index-96e7b26a.js";import"./index-801ff788.js";const fe={class:"hint"},Ie={class:"action-bar"},ke={key:1},_e={class:"no-res-hint"},Ce={class:"hint"},we={key:2,class:"preview-switch"},he=X({__name:"MatchedImageGrid",props:{tabIdx:{},paneIdx:{},selectedTagIds:{},id:{}},setup(z){const I=z,p=me(t=>ne(I.selectedTagIds,t)),{queue:R,images:o,onContextMenuClickU:k,stackViewEl:G,previewIdx:d,previewing:_,onPreviewVisibleChange:E,previewImgMove:C,canPreview:w,itemSize:h,gridItems:N,showGenInfo:m,imageGenInfo:b,q:J,multiSelectedIdxs:x,onFileItemClick:L,scroller:y,showMenuIdx:g,onFileDragStart:P,onFileDragEnd:U,cellWidth:q,onScroll:M,saveAllFileAsJson:O,saveLoadedFileAsJson:W}=ue(p);return Y(()=>I.selectedTagIds,async()=>{var t;await p.reset(),await ee(),(t=y.value)==null||t.scrollToItem(0),M()},{immediate:!0}),(t,s)=>{const H=le,Q=ie,S=B,Z=B,j=de;return r(),v("div",{class:"container",ref_key:"stackViewEl",ref:G},[l(j,{size:"large",spinning:!e(R).isIdle},{default:n(()=>{var T,A;return[l(Q,{visible:e(m),"onUpdate:visible":s[1]||(s[1]=i=>F(m)?m.value=i:null),width:"70vw","mask-closable":"",onOk:s[2]||(s[2]=i=>m.value=!1)},{cancelText:n(()=>[]),default:n(()=>[l(H,{active:"",loading:!e(J).isIdle},{default:n(()=>[c("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:s[0]||(s[0]=i=>e(se)(e(b)))},[c("div",fe,a(t.$t("doubleClickToCopy")),1),u(" "+a(e(b)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),c("div",Ie,[l(S,{onClick:e(W)},{default:n(()=>[u(a(t.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"]),l(S,{onClick:e(O)},{default:n(()=>[u(a(t.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])]),(T=e(o))!=null&&T.length?(r(),V(e(re),{key:0,ref_key:"scroller",ref:y,class:"file-list",items:e(o),"item-size":e(h).first,"key-field":"fullpath","item-secondary-size":e(h).second,gridItems:e(N),onScroll:e(M)},{default:n(({item:i,index:$})=>[l(ce,{idx:$,file:i,"cell-width":e(q),"show-menu-idx":e(g),"onUpdate:showMenuIdx":s[3]||(s[3]=K=>F(g)?g.value=K:null),onDragstart:e(P),onDragend:e(U),onFileItemClick:e(L),"full-screen-preview-image-url":e(o)[e(d)]?e(te)(e(o)[e(d)]):"",selected:e(x).includes($),onContextMenuClick:e(k),onPreviewVisibleChange:e(E),"is-selected-mutil-files":e(x).length>1},null,8,["idx","file","cell-width","show-menu-idx","onDragstart","onDragend","onFileItemClick","full-screen-preview-image-url","selected","onContextMenuClick","onPreviewVisibleChange","is-selected-mutil-files"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):e(p).load&&t.selectedTagIds.and_tags.length===1&&!((A=t.selectedTagIds.folder_paths_str)!=null&&A.trim())?(r(),v("div",ke,[c("div",_e,[c("p",Ce,a(t.$t("tagSearchNoResultsMessage")),1),l(Z,{onClick:s[4]||(s[4]=i=>e(ve)()),type:"primary"},{default:n(()=>[u(a(t.$t("rebuildImageIndex")),1)]),_:1})])])):f("",!0),e(_)?(r(),v("div",we,[l(e(pe),{onClick:s[5]||(s[5]=i=>e(C)("prev")),class:D({disable:!e(w)("prev")})},null,8,["class"]),l(e(ge),{onClick:s[6]||(s[6]=i=>e(C)("next")),class:D({disable:!e(w)("next")})},null,8,["class"])])):f("",!0)]}),_:1},8,["spinning"]),e(_)&&e(o)&&e(o)[e(d)]?(r(),V(ae,{key:0,file:e(o)[e(d)],idx:e(d),onContextMenuClick:e(k)},null,8,["file","idx","onContextMenuClick"])):f("",!0)],512)}}});const $e=oe(he,[["__scopeId","data-v-d36b6e6b"]]);export{$e as default};
