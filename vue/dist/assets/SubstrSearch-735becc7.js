import{d as de,v as b,av as ue,bP as L,bR as ce,a5 as pe,ab as ve,a8 as me,bQ as P,bS as ge,o as r,k as y,C as G,c as n,E as e,b_ as fe,l as d,T as S,A as h,B as i,m as f,t as u,p as _,G as J,H as ke,R as we,Y as be,Z as N,bX as he,V as _e,W as xe,b$ as Ce,bZ as Ie,q as ye}from"./index-e82e9f1c.js";import{f as Se,S as $e}from"./fullScreenContextMenu-7792ff59.js";/* empty css              */import{g as Ae,F as Me}from"./FileItem-3c183d4e.js";import{c as ze,u as Fe,L as Be,R as De}from"./hook-a9271142.js";import"./index-96e7b26a.js";import"./index-801ff788.js";import"./functionalCallableComp-4ee97acb.js";const Re="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",Ee=["src"],Ve={class:"search-bar"},Ue={class:"form-name"},Te={class:"search-bar last actions"},qe={class:"hint"},Ke={key:1,class:"preview-switch"},Le=de({__name:"SubstrSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(H){const $=H,p=b(!1),v=b(""),k=b($.searchScope??""),x=ze(a=>{const s={cursor:a,regexp:p.value?v.value:"",surstr:p.value?"":v.value,folder_paths:(k.value??"").split(/,|\n/).map(g=>g.trim()).filter(g=>g)};return Ce(s)}),{queue:c,images:o,onContextMenuClickU:A,stackViewEl:O,previewIdx:m,previewing:M,onPreviewVisibleChange:Q,previewImgMove:z,canPreview:F,itemSize:B,gridItems:W,showGenInfo:w,imageGenInfo:D,q:Z,multiSelectedIdxs:R,onFileItemClick:X,scroller:E,showMenuIdx:C,onFileDragStart:Y,onFileDragEnd:j,cellWidth:ee,onScroll:V,saveAllFileAsJson:se,saveLoadedFileAsJson:ae}=Fe(x),t=b();ue(async()=>{t.value=await L(),t.value.img_count&&t.value.expired&&await U(),$.searchScope&&await I()});const U=ce(()=>c.pushAction(async()=>(await Ie(),t.value=await L(),t.value)).res),I=async()=>{await x.reset({refetch:!0}),await pe(),V(),E.value.scrollToItem(0),o.value.length||ve.info(me("fuzzy-search-noResults"))};P("returnToIIB",async()=>{const a=await c.pushAction(ge).res;t.value.expired=a.expired}),P("searchIndexExpired",()=>t.value&&(t.value.expired=!0));const te=()=>{p.value=!p.value};return(a,s)=>{const g=be,T=N,le=he,q=N,ne=_e,ie=xe,oe=$e;return r(),y("div",{class:"container",ref_key:"stackViewEl",ref:O},[t.value?(r(),y("div",{key:0,class:"search-bar",onKeydown:s[2]||(s[2]=G(()=>{},["stop"]))},[n(g,{value:v.value,"onUpdate:value":s[0]||(s[0]=l=>v.value=l),placeholder:a.$t("fuzzy-search-placeholder")+" "+a.$t("regexSearchEnabledHint"),disabled:!e(c).isIdle,onKeydown:fe(I,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),d("div",{class:S(["regex-icon",{selected:p.value}]),onKeydown:s[1]||(s[1]=G(()=>{},["stop"])),onClick:te,title:"Use Regular Expression"},[d("img",{src:e(Re)},null,8,Ee)],34),t.value.expired||!t.value.img_count?(r(),h(T,{key:0,onClick:e(U),loading:!e(c).isIdle,type:"primary"},{default:i(()=>[f(u(t.value.img_count===0?a.$t("generateIndexHint"):a.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(r(),h(T,{key:1,type:"primary",onClick:I,loading:!e(c).isIdle||e(x).loading,disabled:!v.value&&!k.value},{default:i(()=>[f(u(a.$t("search")),1)]),_:1},8,["loading","disabled"]))],32)):_("",!0),d("div",Ve,[d("div",Ue,u(a.$t("searchScope")),1),n(le,{"auto-size":{maxRows:8},value:k.value,"onUpdate:value":s[3]||(s[3]=l=>k.value=l),placeholder:a.$t("specifiedSearchFolder")},null,8,["value","placeholder"])]),d("div",Te,[n(q,{onClick:e(ae)},{default:i(()=>[f(u(a.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"]),n(q,{onClick:e(se)},{default:i(()=>[f(u(a.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])]),n(oe,{size:"large",spinning:!e(c).isIdle},{default:i(()=>[n(ie,{visible:e(w),"onUpdate:visible":s[5]||(s[5]=l=>J(w)?w.value=l:null),width:"70vw","mask-closable":"",onOk:s[6]||(s[6]=l=>w.value=!1)},{cancelText:i(()=>[]),default:i(()=>[n(ne,{active:"",loading:!e(Z).isIdle},{default:i(()=>[d("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:s[4]||(s[4]=l=>e(ke)(e(D)))},[d("div",qe,u(a.$t("doubleClickToCopy")),1),f(" "+u(e(D)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),e(o)?(r(),h(e(Ae),{key:0,ref_key:"scroller",ref:E,class:"file-list",items:e(o),"item-size":e(B).first,"key-field":"fullpath","item-secondary-size":e(B).second,gridItems:e(W),onScroll:e(V)},{default:i(({item:l,index:K})=>[n(Me,{idx:K,file:l,"show-menu-idx":e(C),"onUpdate:showMenuIdx":s[7]||(s[7]=re=>J(C)?C.value=re:null),onFileItemClick:e(X),"full-screen-preview-image-url":e(o)[e(m)]?e(we)(e(o)[e(m)]):"","cell-width":e(ee),selected:e(R).includes(K),onContextMenuClick:e(A),onDragstart:e(Y),onDragend:e(j),"is-selected-mutil-files":e(R).length>1,onPreviewVisibleChange:e(Q)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):_("",!0),e(M)?(r(),y("div",Ke,[n(e(Be),{onClick:s[8]||(s[8]=l=>e(z)("prev")),class:S({disable:!e(F)("prev")})},null,8,["class"]),n(e(De),{onClick:s[9]||(s[9]=l=>e(z)("next")),class:S({disable:!e(F)("next")})},null,8,["class"])])):_("",!0)]),_:1},8,["spinning"]),e(M)&&e(o)&&e(o)[e(m)]?(r(),h(Se,{key:1,file:e(o)[e(m)],idx:e(m),onContextMenuClick:e(A)},null,8,["file","idx","onContextMenuClick"])):_("",!0)],512)}}});const Ze=ye(Le,[["__scopeId","data-v-15925450"]]);export{Ze as default};
